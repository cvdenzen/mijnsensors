pipeline {
    agent any
    stages {
        stage('build') {
            steps {
                sh 'mvn --version'
                sh 'cd pilightMqttOsgi;mvn clean install'
            }
        }
        stage('Deploy') {
            environment {
                PI_RPI3_CREDS = credentials('pi_rpi3')
            }
            steps {
                // remove old file
                // sh 'sshpass -p $PI_RPI3_CREDS_PSW ssh pi@rpi2 \'rm --force /usr/share/karaf/deploy/pigpioj-java-2.4.jar\''
                sh 'cd pilightMqttOsgi;sshpass -p $PI_RPI3_CREDS_PSW rsync target/pilightMqttOsgi-1.0-SNAPSHOT.jar pi@rpi2-eth.home:/usr/share/karaf/deploy'
                sh 'cd pilightMqttOsgi;sshpass -p $PI_RPI3_CREDS_PSW rsync target/classes/nl/vandenzen/iot/pilightmqttosgi-features.xml pi@rpi2-eth.home:/usr/share/karaf/deploy'
                // sh 'sshpass -p $PI_RPI3_CREDS_PSW rsync /home/carl/.m2/repository/uk/pigpioj/pigpioj-java/2.5.1/pigpioj-java-2.5.1.jar pi@rpi3:/usr/share/karaf/deploy'
            }
        }
    }
}

