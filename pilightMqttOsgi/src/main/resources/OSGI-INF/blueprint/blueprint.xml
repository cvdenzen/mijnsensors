<?xml version="1.0" encoding="UTF-8"?>
<!--

autoonenabled wordt in principe hier bijgehouden en niet in Openhab.

-->
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="
             http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
             http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">

    <camelContext xmlns="http://camel.apache.org/schema/blueprint" id="blueprintcontext">
        <dataFormats>
            <json id="jsonJsonOHRestItem" library="Gson"
                  unmarshalTypeName="nl.vandenzen.pilightmqttosgi.json.JsonOHRestItem"/>
            <!-- unmarshal to List<Map> is supported by Jackson json -->
            <json id="jsonjackson" library="Jackson" useList="true"/>
        </dataFormats>

        <!-- hopeloos, te weinig documentatie om dit goed te krijgen -->
        <!-- route id="DefineCache" autoStartup="true" startupOrder="5">
		<from uri="ehcache://oh?configurationUri=file:${karaf.home}/etc/ehcache.xml"/>
		<from uri="ehcache://oh?configurationUri=classpath:etc/ehcache.xml"/>
		    <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
        </route -->

        <route id="HelloWorldFromBlueprint" autoStartup="true">
            <from uri="timer:simple?period=5000&amp;repeatCount=3"/>
            <setBody>
                <simple>Hello World from blueprint (Camel UPSPIco)</simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
        </route>

        <!-- Set item to value. Input: header.OHItem, body -->
        <route id="setOHItem" autoStartup="true">
            <from uri="direct:setOHItem"/>
            <setHeader name="CamelHttpMethod">
                <constant>POST</constant>
            </setHeader>
            <setHeader name="Content-Type">
                <constant>text/plain</constant>
            </setHeader>
            <setHeader name="Accept">
                <constant>application/json</constant>
            </setHeader>
            <setBody>
                <simple>log from setOHItem http://127.0.0.1:8080/rest/items/${header.OHItem}</simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <to uri="http://127.0.0.1:8080/rest/items/${header.OHItem}"/>
        </route>


        <!-- Test setOHItem-->
        <route id="testSetOHItem" autoStartup="true">
            <from uri="quartz://groep/timerTestSetOHItem?cron=0/10+*+*+*+*+?"/>
            <setHeader name="OHItem">
                <constant>LampAchterdeur_Brightness</constant>
            </setHeader>
            <setBody>
                <simple>log from testSetOHItem http://127.0.0.1:8080/rest/items/${header.OHItem}</simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <setBody>
                <!-- percentage 0..100 -->
                <simple>50</simple>
            </setBody>
            <!-- to uri="direct:setOHItem"/ -->
        </route>

        <!-- Deze werkt 17 jan 2020.-->
        <route id="achterlichtAan2020" autoStartup="true">
            <from uri="direct:achterlichtaan2020"/>
            <setHeader name="CamelHttpMethod">
                <constant>POST</constant>
            </setHeader>
            <setHeader name="Content-Type">
                <constant>text/plain</constant>
            </setHeader>
            <setHeader name="Accept">
                <constant>application/json</constant>
            </setHeader>
            <setBody>
                <!-- percentage 0..100 -->
                <simple>100</simple>
            </setBody>
            <to uri="http://127.0.0.1:8080/rest/items/LampAchterdeur_Brightness"/>
        </route>


        <route id="achterlichtUit2020" autoStartup="true">
            <from uri="direct:achterlichtuit2020"/>
            <setHeader name="CamelHttpMethod">
                <constant>POST</constant>
            </setHeader>
            <setHeader name="Content-Type">
                <constant>text/plain</constant>
            </setHeader>
            <setHeader name="Accept">
                <constant>application/json</constant>
            </setHeader>
            <setBody>
                <!-- percentage 0..100 -->
                <simple>0</simple>
            </setBody>
            <to uri="http://127.0.0.1:8080/rest/items/LampAchterdeur_Brightness"/>
        </route>

        <route id="requestLightsOnIntensityThreshold" autoStartup="true" streamCache="true">
            <from uri="quartz://groep/timerRq001?cron=0/10+*+*+*+*+?"/>
            <setHeader name="CamelHttpMethod">
                <constant>GET</constant>
            </setHeader>
            <to uri="http://127.0.0.1:8080/rest/items/LightsOnIntensityThreshold"/>
            <log message="Test: Response LightsOnIntensityThreshold is ${body}"/>
            <unmarshal>
                <custom ref="jsonJsonOHRestItem"/>
            </unmarshal>
            <log message="After unmarshal jsonjackson body=${body}"/>
            <setBody>
                <!-- jsonpath>$.state</jsonpath -->
                <simple>${body.state}</simple>
            </setBody>
            <log message="Test, LightsOnIntensityThreshold unmarshalled is ${body}"/>
            <convertBodyTo type="java.lang.String"/>
            <convertBodyTo type="java.lang.Float"/>
            <setHeader name="LightsOnIntensityThreshold">
                <method ref="LightsOnIntensityThreshold" method="getValue"/>
            </setHeader>
        </route>

        <!-- Zet lichten aan -->
        <route id="ZetLichtenAan" autoStartup="true" startupOrder="101">
            <from uri="direct:ZetLichtenAan"/>
            <setBody>
                <simple>Lichten gaan aan!</simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <setBody>
                <constant>on</constant>
            </setBody>
            <to uri="paho:f0/kaku_switch_old/cmd/3/0"/>
            <to uri="paho:f0/kaku_switch_old/cmd/3/1"/>
        </route>

        <!-- Zet lichten uit -->
        <route id="ZetLichtenUit" autoStartup="true" startupOrder="102">
            <from uri="direct:ZetLichtenUit"/>
            <setBody>
                <constant>off</constant>
            </setBody>
            <to uri="paho:f0/kaku_switch_old/cmd/3/0"/>
            <to uri="paho:f0/kaku_switch_old/cmd/3/1"/>
        </route>

        <!-- Zet 1 licht aan -->
        <route id="Light_GF_Huiskamer_Achterdeur_Schemerlamp_aan" autoStartup="true" startupOrder="103">
            <from uri="direct:Light_GF_Huiskamer_Achterdeur_Schemerlamp_aan"/>
            <!-- old jan 2020 -->
            <setBody>
                <constant>on</constant>
            </setBody>
            <to uri="paho:f0/kaku_switch_old/cmd/3/0"/>
            <to uri="direct:achterlichtaan2020"/>
        </route>
        <!-- Zet 1 licht uit -->
        <route id="Light_GF_Huiskamer_Achterdeur_Schemerlamp_uit" autoStartup="true" startupOrder="104">
            <from uri="direct:Light_GF_Huiskamer_Achterdeur_Schemerlamp_uit"/>
            <!-- old jan 2020 -->
            <setBody>
                <constant>off</constant>
            </setBody>
            <to uri="paho:f0/kaku_switch_old/cmd/3/0"/>
            <to uri="direct:achterlichtuit2020"/>
        </route>

        <!-- Zet 1 licht aan -->
        <route id="Light_GF_Huiskamer_Achter_Staandelamp_aan" autoStartup="true" startupOrder="105">
            <from uri="direct:Light_GF_Huiskamer_Achter_Staandelamp_aan"/>
            <setBody>
                <constant>on</constant>
            </setBody>
            <to uri="paho:f0/kaku_switch_old/cmd/3/1"/>
        </route>
        <!-- Zet 1 licht uit -->
        <route id="Light_GF_Huiskamer_Achter_Staandelamp_uit" autoStartup="true" startupOrder="106">
            <from uri="direct:Light_GF_Huiskamer_Achter_Staandelamp_uit"/>
            <setBody>
                <constant>off</constant>
            </setBody>
            <to uri="paho:f0/kaku_switch_old/cmd/3/1"/>
        </route>
        <!-- Listen to kaku remote control -->
        <route id="KakuRemoteControl_3_0" autoStartup="true" startupOrder="107">
            <from uri="paho:f0/kaku_switch_old/rc/3/0"/>
            <!-- this is a manual intervention, stop scheduled actions -->
            <bean ref="DelayHuiskamerAchterdeurSchemerlamp" method="cancel"/>
        </route>

        <route id="LichtIntensiteit_Woonkamer_updated" autoStartup="true" startupOrder="200">
            <from uri="paho:oh/all/LichtIntensiteit_Woonkamer/state"/>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <convertBodyTo type="java.lang.String"/>
            <convertBodyTo type="java.lang.Float"/>
            <bean ref="LichtIntensiteit_Woonkamer" method="setValue"/>
            <to uri="direct:Enable_lights_on_by_daylight"/>
        </route>

        <route id="pir_gf_achterdeur17_updated" autoStartup="true" startupOrder="201">
            <from uri="direct:pir_gf_achterdeur17_updated"/>
            <!-- set states of light etc. in header of the message -->
            <to uri="direct:SetHeaders"/>
            <log message="in.header.LichtIntensiteit_Woonkamer=${in.header.LichtIntensiteit_Woonkamer}"/>
            <log message="in.header.LightsOnIntensityThreshold=${in.header.LightsOnIntensityThreshold}"/>
            <setBody>
                <simple>
                    "Light_GF_Huiskamer_Achterdeur_Schemerlamp=${in.header.Light_GF_Huiskamer_Achterdeur_Schemerlamp})
                </simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <choice>
                <when>
                    <simple>${in.header.pir_gf_achterdeur17}</simple>
                    <log message="pir is true"/>
                    <when>
                        <simple>${in.header.LichtIntensiteit_Woonkamer} &lt; ${in.header.LightsOnIntensityThreshold}
                        </simple>
                        <log message="lichtinsiteit woonkamer&lt;threshold"/>
                        <when>
                            <simple>${in.header.LampAchterdeur_Brightness} &lt; 1</simple>
                            <setBody>
                                <simple>het licht is uit</simple>
                            </setBody>
                            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
                            <to uri="direct:achterlichtaan2020"/>
                            <bean ref="GF_Passenger_minutes" method="getMilliSeconds"/>
                            <convertBodyTo type="java.lang.String"/>
                            <convertBodyTo type="java.lang.Long"/>
                            <bean ref="DelayHuiskamerAchterdeurSchemerlamp" method="setDelay"/>
                            <bean ref="DelayHuiskamerAchterdeurSchemerlamp" method="schedule"/>
                        </when>
                    </when>
                </when>
            </choice>
            <!-- delay, extend with each action on pir -->
            <bean ref="GF_Passenger_minutes" method="getMilliSeconds"/>
            <convertBodyTo type="java.lang.String"/>
            <convertBodyTo type="java.lang.Long"/>
            <bean ref="DelayHuiskamerAchterdeurSchemerlamp" method="setDelay"/>
            <bean ref="DelayHuiskamerAchterdeurSchemerlamp" method="extend"/>
        </route>

        <route id="listenAutoOnEnabled" autoStartup="true" startupOrder="202">
            <from uri="paho:oh/all/AutoOnEnabled/state"/>
            <convertBodyTo type="java.lang.String"/>
            <choice>
                <when>
                    <simple>${in.body} == "1"</simple>
                    <setBody>
                        <constant>true</constant>
                    </setBody>
                </when>
                <otherwise>
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                </otherwise>
            </choice>
            <convertBodyTo type="java.lang.Boolean"/>
            <bean ref="AutoOnEnabled" method="setValue"/>
            <!-- Turn on lights? -->
            <to uri="direct:Enable_lights_on_by_daylight"/>
        </route>
        <route id="listenLightsOnIntensityThreshold" autoStartup="true" startupOrder="203">
            <from uri="paho:oh/all/LightsOnIntensityThreshold/state"/>
            <log message="paho:oh/all/LightsOnIntensityThreshod changed to ${body}"/>
            <convertBodyTo type="java.lang.String"/>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <convertBodyTo type="java.lang.Integer"/>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <bean ref="LightsOnIntensityThreshold" method="setValue"/>
            <!-- Turn on lights? -->
            <to uri="direct:Enable_lights_on_by_daylight"/>
        </route>
        <route id="listenLight_GF_Huiskamer_Achterdeur_Schemerlamp" autoStartup="true" startupOrder="204">
            <from uri="paho:oh/all/Light_GF_Huiskamer_Achterdeur_Schemerlamp_Dimm/state"/>
            <convertBodyTo type="java.lang.String"/>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <choice>
                <when>
                    <simple>${in.body} == "ON"</simple>
                    <setBody>
                        <constant>true</constant>
                    </setBody>
                </when>
                <otherwise>
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                </otherwise>
            </choice>
            <bean ref="Light_GF_Huiskamer_Achterdeur_Schemerlamp" method="setValue"/>
        </route>
        <route id="listenGF_Passenger_minutes" autoStartup="true" startupOrder="205">
            <from uri="paho:oh/all/GF_Passenger_minutes/state"/>
            <convertBodyTo type="java.lang.String"/>
            <convertBodyTo type="java.lang.Integer"/>
            <bean ref="GF_Passenger_minutes" method="setValue"/>
        </route>
        <route id="listen_bg_w_tv_w" autoStartup="true" startupOrder="206">
            <from uri="paho:oh/all/bg_w_tv_w/state"/>
            <!-- get old value of bg_w_tv_w -->
            <setHeader name="bg_w_tv_w">
                <method ref="bg_w_tv_w" method="getValue"/>
            </setHeader>
            <!-- get old value of bg_w_tv_w_stable -->
            <setHeader name="bg_w_tv_w_stable">
                <method ref="bg_w_tv_w_stable" method="getValue"/>
            </setHeader>
            <choice>
                <when>
                    <simple>${in.body} == "ON"</simple>
                    <setBody>
                        <constant>true</constant>
                    </setBody>
                </when>
                <otherwise>
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                </otherwise>
            </choice>
            <bean ref="bg_w_tv_w" method="setValue"/>
            <log message="Values old: ${headers.bg_w_tv_w}, new: ${body}; Stable: ${headers.bg_w_tv_w_stable}"/>
            <setBody>
                <simple>
                    request.headers.get= ${in.headers.bg_w_tv_w}, request.body=${body}
                </simple>
            </setBody>
            <log message="${body}"/>
            <!-- restore body contents after log message -->
            <bean ref="bg_w_tv_w" method="getValue"/>
            <!-- calculate stable count -->
            <choice>
                <when>
                    <!-- normally this would not happen, as only changes are reported -->
                    <simple>${in.headers.bg_w_tv_w} == ${body}</simple>
                    <log message="Same value old: ${headers.bg_w_tv_w}, new: ${body}"/>
                </when>
                <otherwise>
                    <setBody>
                        <constant>0</constant>
                    </setBody>
                    <bean ref="bg_w_tv_w_stable" method="setValue"/>
                </otherwise>
            </choice>
            <setBody>
                <simple>Stable count is ${body}</simple>
            </setBody>
            <!--to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/ -->
            <log message="Stable count is ${body}"/>
            <!-- check whether to turn lights off -->
            <to uri="direct:LightsOffCalc"/>
        </route>

        <route id="listenbg_x_imac2" autoStartup="true" startupOrder="207">
            <from uri="paho:oh/all/bg_x_imac2/state"/>
            <choice>
                <when>
                    <simple>${in.body} == "ON"</simple>
                    <setBody>
                        <constant>true</constant>
                    </setBody>
                </when>
                <otherwise>
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                </otherwise>
            </choice>
            <bean ref="bg_x_imac2" method="setValue"/>
            <!-- check whether to turn lights off -->
            <to uri="direct:LightsOffCalc"/>
        </route>

        <route id="listenbg_x_imac3" autoStartup="true" startupOrder="208">
            <from uri="paho:oh/all/bg_x_imac3/state"/>
            <choice>
                <when>
                    <simple>${in.body} == "ON"</simple>
                    <setBody>
                        <constant>true</constant>
                    </setBody>
                </when>
                <otherwise>
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                </otherwise>
            </choice>
            <bean ref="bg_x_imac3" method="setValue"/>
            <!-- check whether to turn lights off -->
            <to uri="direct:LightsOffCalc"/>
        </route>

        <!-- not used 17 jan 2020 -->
        <route id="listenPir_gf_achterdeur17" autoStartup="true" startupOrder="209">
            <from uri="paho:oh/all/pir_gf_achterdeur17/state"/>
            <convertBodyTo type="java.lang.String"/>
            <choice>
                <when>
                    <simple>${in.body} == "CLOSED"</simple>
                    <setBody>
                        <constant>true</constant>
                    </setBody>
                </when>
                <otherwise>
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                </otherwise>
            </choice>
            <convertBodyTo type="java.lang.Boolean"/>
            <bean ref="pir_gf_achterdeur17" method="setValue"/>
            <!-- Turn on lights? -->
            <to uri="direct:pir_gf_achterdeur17_updated"/>
        </route>


        <!-- Listen to mysensors mqtt gateway, 17 jan 2020, not to openhab item -->
        <route id="listenPir_gf_achterdeur17a" autoStartup="true" startupOrder="220">
            <from uri="paho:mysensors/all/153/1/1/0/2"/>
            <convertBodyTo type="java.lang.String"/>
            <log message="listenPir_gf_achterdeur17a locA is ${body}"/>
            <choice>
                <when>
                    <simple>${in.body} == "1"</simple>
                    <setBody>
                        <constant>true</constant>
                    </setBody>
                </when>
                <otherwise>
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                </otherwise>
            </choice>
            <convertBodyTo type="java.lang.Boolean"/>
            <bean ref="pir_gf_achterdeur17" method="setValue"/>
            <!-- Turn on lights? -->
            <to uri="direct:pir_gf_achterdeur17_updated"/>
        </route>

        <route id="AutoOnEnabled_aan" autoStartup="true" startupOrder="301">
            <!-- s m h day-of-month month day-of-week year(optional) -->
            <from uri="quartz://groep/timer1?cron=0+0+12+*+*+?"/>
            <setBody>
                <constant>true</constant>
            </setBody>
            <bean ref="AutoOnEnabled" method="setValue"/>
        </route>
        <route id="AutoOffEnabled_aan" autoStartup="true" startupOrder="302">
            <!-- s m h day-of-month month day-of-week year(optional) -->
            <from uri="quartz://groep/timer2?cron=47+50+22+*+*+?"/>
            <setBody>
                <constant>true</constant>
            </setBody>
            <bean ref="AutoOffEnabled" method="setValue"/>
            <!-- check whether to turn lights off -->
            <to uri="direct:LightsOffCalc"/>
        </route>
        <route id="Increment_bg_w_tv_w_stable" autoStartup="true" startupOrder="303">
            <!-- s m h day-of-month month day-of-week year(optional) -->
            <from uri="quartz://groep/timer3?cron=0/10+*+*+*+*+?"/>
            <!-- get old value of bg_w_tv_w_stable -->
            <setHeader name="bg_w_tv_w_stable">
                <method ref="bg_w_tv_w_stable" method="getValue"/>
            </setHeader>
            <setBody>
                <simple>
                    ${in.header.bg_w_tv_w_stable}++
                </simple>
            </setBody>
            <bean ref="bg_w_tv_w_stable" method="setValue"/>
            <!--to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/ -->
            <log message="Increment bg_w_tv_w_stable: Stable count is ${body}"/>
            <!-- check whether to turn lights off -->
            <to uri="direct:LightsOffCalc"/>
        </route>
        <route id="ReportMemoryUsage" autoStartup="true" startupOrder="304">
            <!-- s m h day-of-month month day-of-week year(optional) -->
            <from uri="quartz://groep/timer4?cron=4+*+*+*+*+?"/>
            <bean ref="Runtime" method="maxMemory"/>
            <convertBodyTo type="java.lang.String"/>
            <to uri="paho:sensors/all/runtime/maxMemory"/>
            <bean ref="Runtime" method="totalMemory"/>
            <convertBodyTo type="java.lang.String"/>
            <to uri="paho:sensors/all/runtime/totalMemory"/>
            <bean ref="Runtime" method="freeMemory"/>
            <convertBodyTo type="java.lang.String"/>
            <to uri="paho:sensors/all/runtime/freeMemory"/>
        </route>


        <!-- Generic entry point for turning on the lights automatically based on light settings -->
        <route id="Enable_lights_on_by_daylight" autoStartup="true" startupOrder="401">
            <from uri="direct:Enable_lights_on_by_daylight"/>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <bean ref="LichtIntensiteit_Woonkamer" method="getValue"/>
            <to uri="direct:SetHeaders"/>
            <choice>
                <when>
                    <simple>
                        ${header.AutoOnEnabled} == 1
                    </simple>
                    <when>
                        <!-- it is dark -->
                        <simple>
                            ${header.LichtIntensiteit_Woonkamer} &lt; ${header.LightsOnIntensityThreshold}
                        </simple>
                        <setBody>
                            <simple>Licht gaat aan!</simple>
                        </setBody>
                        <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
                        <to uri="direct:ZetLichtenAan"/>
                        <!-- disable automatic turning on the lights -->
                        <setBody>
                            <constant>false</constant>
                        </setBody>
                        <bean ref="AutoOnEnabled" method="setValue"/>
                    </when>
                </when>
            </choice>
        </route>
        <!-- Generic entry point for turning off the lights automatically based on light settings -->
        <route id="LightsOffCalc" autoStartup="true" startupOrder="402">
            <from uri="direct:LightsOffCalc"/>
            <to uri="direct:SetHeaders"/>
            <choice>
                <when>
                    <simple>
                        ${header.AutoOffEnabled} == 1
                        &amp;&amp; ${header.bg_w_tv_w} == false
                        &amp;&amp; ${header.bg_w_tv_w_stable} > 14
                        &amp;&amp; ${header.bg_x_imac2} == false
                        &amp;&amp; ${header.bg_x_imac3} == false <!-- // and imac is off -->
                    </simple>
                    <setBody>
                        <simple>Licht gaat uit.</simple>
                    </setBody>
                    <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
                    <!-- staande lamp direct uitzetten, achterdeurlamp pas na een delay -->
                    <to uri="direct:Light_GF_Huiskamer_Achter_Staandelamp_uit"/>
                    <!-- disable automatic turning off the lights -->
                    <setBody>
                        <constant>false</constant>
                    </setBody>
                    <bean ref="AutoOffEnabled" method="setValue"/>
                    <!-- delay for only one light (achterdeur)-->
                    <bean ref="GF_Passenger_minutes" method="getMilliSeconds"/>
                    <convertBodyTo type="java.lang.String"/>
                    <convertBodyTo type="java.lang.Long"/>
                    <bean ref="DelayHuiskamerAchterdeurSchemerlamp" method="setDelay"/>
                    <bean ref="DelayHuiskamerAchterdeurSchemerlamp" method="restartTimer"/>
                </when>
            </choice>
        </route>

        <!-- SetHeaders. Body contents not altered -->
        <route id="SetHeaders" autoStartup="true" startupOrder="501">
            <from uri="direct:SetHeaders"/>
            <!-- Save body contents in header BodyContents -->
            <setHeader name="BodyContents">
                <simple>${body}</simple>
            </setHeader>
            <setHeader name="LichtIntensiteit_Woonkamer">
                <method ref="LichtIntensiteit_Woonkamer" method="getValue"/>
            </setHeader>
            <setHeader name="LightsOnIntensityThreshold">
                <method ref="LightsOnIntensityThreshold" method="getValue"/>
            </setHeader>
            <setHeader name="AutoOnEnabled">
                <method ref="AutoOnEnabled" method="getValue"/>
            </setHeader>
            <setHeader name="AutoOffEnabled">
                <method ref="AutoOffEnabled" method="getValue"/>
            </setHeader>
            <setHeader name="pir_gf_achterdeur17">
                <method ref="pir_gf_achterdeur17" method="getValue"/>
            </setHeader>
            <setHeader name="bg_w_tv_w">
                <method ref="bg_w_tv_w" method="getValue"/>
            </setHeader>
            <setHeader name="bg_w_tv_w_stable">
                <method ref="bg_w_tv_w_stable" method="getValue"/>
            </setHeader>
            <setHeader name="bg_x_imac2">
                <method ref="bg_x_imac2" method="getValue"/>
            </setHeader>
            <setHeader name="bg_x_imac3">
                <method ref="bg_x_imac3" method="getValue"/>
            </setHeader>
            <setHeader name="Light_GF_Huiskamer_Achterdeur_Schemerlamp">
                <method ref="Light_GF_Huiskamer_Achterdeur_Schemerlamp" method="getValue"/>
            </setHeader>
        </route>

        <route id="test1" autoStartup="true" startupOrder="9002" streamCache="true">
            <!-- s m h day-of-month month day-of-week year(optional) -->
            <from uri="quartz://groep/timer9002?cron=0/10+*+*+*+*+?"/>
            <!-- Save body contents -->
            <setHeader name="BodyContents">
                <simple>${body}</simple>
            </setHeader>
            <setBody>
                <constant>true</constant>
            </setBody>
            <log message="Body voordat headers voor http worden geset: ${body}"/>
            <setHeader name="CamelHttpMethod">
                <constant>GET</constant>
            </setHeader>
            <setHeader name="Content-Type">
                <constant>application/json</constant>
            </setHeader>
            <setHeader name="Accept">
                <constant>application/json</constant>
            </setHeader>
            <setBody>
                <constant></constant>
            </setBody>
            <log message="setHeaders locL ${body}"/>
            <!-- 21 jan 2020: LampAchterdeur_Brightness is 89 procent, instelling door Hester -->
            <to uri="http://127.0.0.1:8080/rest/items/Light_GF_Huiskamer_Achterdeur_Schemerlamp_Dimm"/>
            <log message="Response Light_GF_Huiskamer_Achterdeur_Schemerlamp_Dimm is ${body}"/>
            <!--setBody><simple>[${body}]</simple></setBody -->
            <log message="Response Light_GF_Huiskamer_Achterdeur_Schemerlamp_Dimm locC is ${body}"/>
            <unmarshal>
                <custom ref="jsonJsonOHRestItem"/>
            </unmarshal>
            <log message="After unmarshal jsonjackson body=${body}"/>
            <setBody>
                <!-- jsonpath>$.state</jsonpath -->
                <simple>${body.state}</simple>
            </setBody>
            <log message="setHeaders state: ${body}"/>
            <setHeader name="Light_GF_Huiskamer_Achterdeur_Schemerlamp_Dimm">
                <simple>${body}</simple>
            </setHeader>
            <log message="setHeaders locM ${body}"/>
            <!-- Restore body -->
            <!--setBody>
                <groovy>request.headers.get('BodyContents')</javaScript>
            </setBody -->
            <log message="setHeaders locN ${body}"/>
        </route>

    </camelContext>
    <!-- bean id="autoOnEnabled" class="java.util.concurrent.atomic.AtomicReference"/ -->
    <bean id="AutoOnEnabled" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <bean id="AutoOffEnabled" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <bean id="pir_gf_achterdeur17" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <bean id="LightsOnIntensityThreshold" class="nl.vandenzen.pilightmqttosgi.util.MutableFloat">
        <property name="value" value="4"/>
    </bean>
    <bean id="LightsEnableIntensityThreshold" class="nl.vandenzen.pilightmqttosgi.util.MutableInteger">
        <property name="value" value="31"/>
    </bean>
    <bean id="LichtIntensiteit_Woonkamer" class="nl.vandenzen.pilightmqttosgi.util.MutableFloat">
        <property name="value" value="50"/>
    </bean>
    <bean id="Light_GF_Huiskamer_Achterdeur_Schemerlamp" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <bean id="Light_GF_Huiskamer_Achter_Staandelamp" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <bean id="GF_Passenger_minutes" class="nl.vandenzen.pilightmqttosgi.util.MutableLong">
        <property name="value" value="1"/>
    </bean>


    <bean id="bg_w_tv_w" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <!-- for debounce, add history count -->
    <bean id="bg_w_tv_w_stable" class="nl.vandenzen.pilightmqttosgi.util.MutableInteger"/>
    <bean id="bg_x_imac2" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <bean id="bg_x_imac3" class="nl.vandenzen.pilightmqttosgi.util.MutableBoolean"/>
    <bean id="DelayHuiskamerAchterdeurSchemerlamp" class="nl.vandenzen.pilightmqttosgi.beans.ExtendableDelay">
        <!-- The uri to call when delay has finished -->
        <argument value="direct:Light_GF_Huiskamer_Achterdeur_Schemerlamp_uit"/>
    </bean>
    <!-- For memory size reporting -->
    <bean id="Runtime" class="java.lang.Runtime"
          factory-method="getRuntime"/>

    <!-- Experimental LCD -->
    <!-- bean id="LCD" class="nl.vandenzen.pilightmqttosgi.LCD" factory-method="getLCD"/ -->


</blueprint>
