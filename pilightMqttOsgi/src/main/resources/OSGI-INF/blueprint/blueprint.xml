<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

    <camelContext xmlns="http://camel.apache.org/schema/blueprint" id="blueprintcontext">
        <route id="HelloWorldFromBlueprint" autoStartup="false">
            <from uri="timer:simple?period=5000&amp;repeatCount=3"/>
            <setBody>
                <simple>Hello World from blueprint (Camel UPSPIco)</simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
        </route>

        <route id="LichtIntensiteit_Woonkamer_updated" autoStartup="true" startupOrder="200">
            <from uri="paho:oh/LichtIntensiteit_Woonkamer"/>
            <to uri="bean:lichtIntensiteit_Woonkamer?method=setValue"/>
            <to uri="direct:Enable_lights_on_by_daylight"/>
        </route>

        <route id="direct:Enable_lights_on_by_daylight" autoStartup="true" startupOrder="100">
            <from uri="direct:Enable_lights_on_by_daylight"/>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
            <!-- If enough light, enable automatic switch on -->

            <choice>
                <when>
                    <simple> ${in.body} > 30 </simple>
                    <setBody><simple>1</simple></setBody>
                    <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
                    <to uri="bean:autoOnEnabled?method=setValue" />
                </when>
            </choice>
        </route>

    </camelContext>
    <bean id="lichtIntensiteit_Woonkamer" class="java.util.concurrent.atomic.AtomicReference"/>
    <bean id="autoOnEnabled" class="java.util.concurrent.atomic.AtomicReference"/>


</blueprint>