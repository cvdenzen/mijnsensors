<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

    <camelContext xmlns="http://camel.apache.org/schema/blueprint" id="simple">
        <route id="HelloWorldFromBlueprint" autoStartup="false">
            <from uri="timer:simple?period=5000&amp;repeatCount=3"/>
            <setBody>
                <simple>Hello World from blueprint (Camel UPSPIco)</simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
        </route>

        <route id="picoUPSSquareWave" autoStartup="true">
            <from uri="timer:picoUPS?period=250"/>
            <to uri="bean:UPSPIco?method=toggleGpio27"/>
        </route>


        <route id="PirSensorFromTopic" autoStartup="true" startupOrder="100">
            <from uri="activemq:topic:f0.nnw.pir"/>

            <setHeader headerName="CamelMqttTopic">
                <constant>f0/nnw/pir</constant>
            </setHeader>
            <to uri="paho:${header.CamelMqttTopic}?brokerUrl=tcp://{{mqttserver}}:{{mqttport}}"/>

        </route>

    </camelContext>

    <bean id="UPSPIco" class="nl.vandenzen.pilightmqttosgi.UPSPIco"/>
</blueprint>