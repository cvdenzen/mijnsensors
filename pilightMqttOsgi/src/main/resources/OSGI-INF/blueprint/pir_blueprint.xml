<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

    <camelContext xmlns="http://camel.apache.org/schema/blueprint" id="pir">
        <route id="HelloWorldFromPirBlueprint" autoStartup="true">
            <from uri="timer:simple?period=5000&amp;repeatCount=3"/>
            <setBody>
                <simple>Hello World from blueprint (Camel, pir)</simple>
            </setBody>
            <to uri="log:nl.vandenzen.pilightmqttosgi?level=INFO"/>
        </route>

        <!-- sensor on phys pin 15 (13 does not work, always 1), gpio-3 -->
        <!-- route id="PirSensor" autoStartup="true">
            <from uri="paho:f0/nnw/pir"/>
            <to/>
        </route -->
        <route id="PirSensorFromTopic" autoStartup="true" startupOrder="100">
            <from uri="activemq:topic:f0.nnw.pir"/>

            <setHeader headerName="CamelMqttTopic">
                <constant>f0/nnw/pir</constant>
            </setHeader>
            <to uri="paho:${header.CamelMqttTopic}?brokerUrl=tcp://{{mqttserver}}:{{mqttport}}"/>

    </route>

    </camelContext>

    <!-- Start class -->
    <bean id="pirSensor" class="nl.vandenzen.pilightmqttosgi.PirSensor"/>
</blueprint>